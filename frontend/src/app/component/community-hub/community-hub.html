<div class="community-hub-container">
  <!-- Header -->
  <div class="community-header">
    <h1 class="main-title">
      <mat-icon class="community-icon">groups</mat-icon>
      Travel Community
    </h1>
    <p class="subtitle">Share your travel stories, tips, and inspire fellow travelers</p>
  </div>

  <!-- Create Post Section -->
  <div class="create-post-section">
    <button mat-raised-button 
        color="primary" 
        (click)="showCreateForm = true"
        *ngIf="!showCreateForm"
        class="create-post-btn">
      <mat-icon>create</mat-icon>
      Create Post
    </button>
    <mat-card class="post-form-card" *ngIf="showCreateForm">
      <mat-card-header>
        <mat-icon mat-card-avatar class="post-icon">create</mat-icon>
        <mat-card-title>Share Your Travel Story</mat-card-title>
        <mat-card-subtitle>Tell the community about your amazing journey</mat-card-subtitle>

      </mat-card-header>

      <mat-card-content>
        <form class="post-form" (ngSubmit)="submitPost()">
          <!-- Title with custom label above -->
          <div class="custom-field">
            <label class="custom-label">Journey Title</label>
            <mat-form-field appearance="outline" class="full-width">
              <input matInput 
                    [(ngModel)]="newPost.title" 
                    name="title"
                    placeholder="e.g., Amazing weekend in Goa"
                    required>
              <mat-icon matSuffix>title</mat-icon>
            </mat-form-field>
          </div>

          <!-- Route and City with custom labels -->
          <div class="form-row">
            <div class="custom-field half-width">
              <label class="custom-label">Route</label>
              <mat-form-field appearance="outline">
                <input matInput 
                      [(ngModel)]="newPost.route" 
                      name="route"
                      placeholder="e.g., Mumbai to Goa">
                <mat-icon matSuffix>route</mat-icon>
              </mat-form-field>
            </div>

            <div class="custom-field half-width">
              <label class="custom-label">Destination</label>
              <mat-form-field appearance="outline">
                <input matInput 
                      [(ngModel)]="newPost.city" 
                      name="city"
                      placeholder="e.g., Goa, Kerala">
                <mat-icon matSuffix>location_on</mat-icon>
              </mat-form-field>
            </div>
          </div>

          <!-- Travel Story with custom label -->
          <div class="custom-field">
            <label class="custom-label">Your Travel Story</label>
            <mat-form-field appearance="outline" class="full-width">
              <textarea matInput 
                        cdkTextareaAutosize
                        cdkAutosizeMinRows="3"
                        cdkAutosizeMaxRows="8"
                        [(ngModel)]="newPost.story"
                        name="story"
                        placeholder="Share your travel experience, what made it special..."
                        required></textarea>
              <mat-icon matSuffix>auto_stories</mat-icon>
            </mat-form-field>
          </div>

          <!-- Travel Tips with custom label -->
          <div class="custom-field">
            <label class="custom-label">Travel Tips & Advice</label>
            <mat-form-field appearance="outline" class="full-width">
              <textarea matInput 
                        cdkTextareaAutosize
                        cdkAutosizeMinRows="2"
                        cdkAutosizeMaxRows="6"
                        [(ngModel)]="newPost.tips"
                        name="tips"
                        placeholder="Share helpful tips for other travelers..."></textarea>
              <mat-icon matSuffix>tips_and_updates</mat-icon>
            </mat-form-field>
          </div>

          <!-- Photo Upload -->
          <div class="photo-upload-section" (click)="fileInput.click()">
            <label class="photo-upload-label">
              <mat-icon>add_photo_alternate</mat-icon>
              Add Photos
            </label>
            <input #fileInput
                  type="file" 
                  multiple 
                  accept="image/*"
                  (change)="onFileSelect($event)"
                  class="photo-input">
            
            <!-- Selected Photos Preview -->
            <div class="selected-photos" *ngIf="newPost.photos.length > 0">
              <div class="photo-preview" *ngFor="let photo of newPost.photos; let i = index">
                <span class="photo-name">{{ photo.name }}</span>
                <button type="button" 
                        mat-icon-button 
                        color="warn" 
                        (click)="removePhoto(i); $event.stopPropagation();">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit"
                    [disabled]="!newPost.title || !newPost.story"
                    class="submit-btn">
              <mat-icon>share</mat-icon>
              Share My Story
            </button>
            <button mat-stroked-button 
                    type="button" 
                    (click)="resetForm()"
                    class="reset-btn">
              <mat-icon>refresh</mat-icon>
              Reset
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Posts Feed Section -->
  <div class="posts-feed-section">
    <div class="feed-header">
      <h2>
        <mat-icon>explore</mat-icon>
        Travel Stories from Our Community
      </h2>
      <p>Discover amazing travel experiences from fellow travelers</p>
    </div>

    <!-- Posts Grid -->
    <div class="posts-grid">
      <mat-card class="post-card" *ngFor="let post of travelPosts">
        <!-- Post Header -->
        <mat-card-header class="post-header">
          <mat-icon mat-card-avatar class="avatar">account_circle</mat-icon>
          <mat-card-title>{{ post.posterName }}</mat-card-title>
          <mat-card-subtitle>
            <span class="timestamp">{{ formatTimestamp(post.createdAt) }}</span>
            <span class="route" *ngIf="post.route">
              <mat-icon class="small-icon">route</mat-icon>
              {{ post.route }}
            </span>
          </mat-card-subtitle>
          <mat-card-subtitle>
            <span class="timestamp">{{ post.createdAt | date: 'medium' }}</span>
          </mat-card-subtitle>

        </mat-card-header>

        <!-- Post Content -->
        <mat-card-content class="post-content">
          <h3 class="post-title">{{ post.title }}</h3>
          <div class="route-info" *ngIf="post.route">
            <strong>Route:</strong> {{ post.route }}
          </div>

<div class="city-info" *ngIf="post.city">
  <strong>Destination:</strong> {{ post.city }}
</div>

          
          <!-- Photos Grid -->
          <div class="photos-grid" *ngIf="post.photos && post.photos.length > 0">
            <div class="photo-item" 
                 *ngFor="let photo of post.photos; let i = index"
                 [class.single-photo]="post.photos.length === 1"
                 [class.two-photos]="post.photos.length === 2"
                 [class.multiple-photos]="post.photos.length > 2">
              <img *ngFor="let photoUrl of post.photos" [src]="'https://thblatubtblmsqxhwoxp.supabase.co/storage/v1/object/public/community-uploads/' + photo"
                   alt="Travel Photo"
                   (click)="openImageModal(post.photos, i)"
                   class="post-photo">
              <div class="photo-overlay" *ngIf="i === 2 && post.photos.length > 3">
                <span class="more-photos">+{{ post.photos.length - 3 }}</span>
              </div>
            </div>
          </div>

          <div class="post-story">
            <p>{{ post.story }}</p>
          </div>

          <!-- Travel Tips -->
          <div class="travel-tips" *ngIf="post.tips">
            <h4>
              <mat-icon class="tips-icon">lightbulb</mat-icon>
              Travel Tips
            </h4>
            <pre class="tips-content">{{ post.tips }}</pre>
          </div>

          <!-- City Tags -->
          <div class="city-tags" *ngIf="post.city">
            <mat-chip-listbox>
              <mat-chip *ngFor="let city of post.city.split(',')" class="city-chip">
                <mat-icon matChipAvatar>location_on</mat-icon>
                {{ city.trim() }}
              </mat-chip>
            </mat-chip-listbox>
          </div>
        </mat-card-content>

        <!-- Post Actions -->
        <mat-card-actions class="post-actions">
          <button mat-button (click)="likePost(post.id)" class="action-btn">
            <mat-icon>favorite_border</mat-icon>
            Like ({{ post.likes }})
          </button>
          <button mat-button class="action-btn">
            <mat-icon>comment</mat-icon>
            Comment
          </button>
          <button mat-button class="action-btn">
            <mat-icon>share</mat-icon>
            Share
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <!-- Image Modal -->
  <div class="image-modal-overlay" *ngIf="showImageModal" (click)="closeImageModal()">
    <div class="image-modal" (click)="$event.stopPropagation()">
      <button mat-icon-button class="close-modal" (click)="closeImageModal()">
        <mat-icon>close</mat-icon>
      </button>
      
      <button mat-icon-button 
              class="nav-btn prev-btn" 
              (click)="prevImage()"
              *ngIf="currentImageIndex > 0">
        <mat-icon>arrow_back</mat-icon>
      </button>
      
      <img [src]="selectedPhotos[currentImageIndex]" class="modal-image">
      
      <button mat-icon-button 
              class="nav-btn next-btn" 
              (click)="nextImage()"
              *ngIf="currentImageIndex < selectedPhotos.length - 1">
        <mat-icon>arrow_forward</mat-icon>
      </button>
      
      <div class="image-counter">
        {{ currentImageIndex + 1 }} / {{ selectedPhotos.length }}
      </div>
    </div>
  </div>
</div>